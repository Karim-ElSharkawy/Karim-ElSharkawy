name: Daily Contributions

on:
  schedule:
    - cron: '0 8 * * *'  # Runs daily at 8 AM UTC
  workflow_dispatch:

jobs:
  make-contribution:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - name: Configure Git with Your Identity
        run: |
          git config --global user.name "Karim-ElSharkawy"
          git config --global user.email "K_elsharkawy@hotmail.com"  # Replace with your GitHub email

      - name: Update README with a random greeting
        run: |
          # Get today's day name
          DAY_NAME=$(date +'%A')

          # Define random greetings with H1 headers
          GREETINGS=(
            "# Hey there! Itâ€™s Karim Elsharkawy wishing you a fantastic $DAY_NAME! ğŸš€"
            "# Good $DAY_NAME everyone! Karim Elsharkawy here â€“ letâ€™s make it awesome! ğŸ‰"
            "# Hi, Iâ€™m Karim Elsharkawy! Hope your $DAY_NAME is going great! ğŸ˜Š"
            "# Happy $DAY_NAME! Iâ€™m Karim Elsharkawy, and I hope you have an amazing one! â˜€ï¸"
            "# Itâ€™s a wonderful $DAY_NAME, and I, Karim Elsharkawy, am here to spread good vibes! ğŸ§˜"
            "# Hello! Iâ€™m Karim Elsharkawy, checking in this fine $DAY_NAME! ğŸ’ª"
            "# Hey there, Iâ€™m Karim Elsharkawy! Wishing you a productive and happy $DAY_NAME! âœ¨"
            "# Whatâ€™s up? Itâ€™s $DAY_NAME, and I, Karim Elsharkawy, hope itâ€™s treating you well! ğŸ”¥"
            "# Good vibes from me, Karim Elsharkawy, on this beautiful $DAY_NAME! ğŸŒŸ"
            "# Hey folks, Karim Elsharkawy here! Hope your $DAY_NAME is off to a great start! ğŸš€"
          )

          # Pick a random greeting
          RANDOM_GREETING=${GREETINGS[$RANDOM % ${#GREETINGS[@]}]}

          # Use sed to replace the text between <!-- GREETING START --> and <!-- GREETING END -->
          sed -i "/<!-- GREETING START -->/,/<!-- GREETING END -->/c\<!-- GREETING START -->\n$RANDOM_GREETING\n<!-- GREETING END -->" README.md

      - name: Commit changes
        uses: EndBug/add-and-commit@v7
        with:
          author_name: "Karim-ElSharkawy"
          author_email: "K_elsharkawy@hotmail.com"
          message: "Updated daily greeting"
          add: "README.md"

      - name: Push changes
        uses: ad-m/github-push-action@master
        with:
          branch: daily-contribution
          github_token: ${{ secrets.PAT_TOKEN }}

      - name: Open pull request
        uses: peter-evans/create-pull-request@v3
        with:
          title: "Daily Greeting Update"
          commit-message: "Updated daily greeting"
          branch: daily-contribution
          base: main
          body: "This pull request updates the greeting in the README with a new random greeting for today."
          token: ${{ secrets.PAT_TOKEN }}

      - name: Delete branch after merge
        if: github.event.pull_request.merged == true
        uses: SvanBoxel/delete-merged-branch@main
        env:
          GITHUB_TOKEN: ${{ secrets.PAT_TOKEN }}
